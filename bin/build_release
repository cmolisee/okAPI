#!/usr/bin/env sh

set -e
VERSION=$1
NOTES=$2

echo "Create release notes for package... âœ…"
touch release.txt

echo "Add version number: $VERSION to release.txt... âœ…"
echo $VERSION >> release.txt
echo "Add release notes to release.txt... âœ…"
echo $NOTES >> release.txt

echo "Bump the version in manifest.json... âœ…"
sed -i "s|\(\"version\": \)\(.*\),|\1\"$VERSION\",|g" ./src/manifest.json

echo "Create location for release files... âœ…"
mkdir -p releases

echo "Build project files with updated version... âœ…"
npm run build

echo "Zip release: session_storage_hub.$VERSION.zip... âœ…"
zip -r "releases/session_storage_hub.$VERSION.zip" release.txt

echo "Clean temporary assets... âœ…"
rm release.txt

echo
echo "Release build and packaging complete [$VERSION] ðŸ”¥ðŸ”¥ðŸ”¥"